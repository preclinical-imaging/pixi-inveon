# pixi-inveon
Python module for manipulating Siemens Inveon files

# Overview
The Siemens Inveon scanner for small animal imaging produces native output data in two related files with .img and .hdr extensions.
These files are written from the console software.
Siemens provides a workstation with software that will convert to DICOM, but the conversion process requires too many manual steps.

The primary purpose of this software is to convert the Inveon proprietary data to DICOM images.

## Conversion Considerations

The Inveon scanner produces 3D CT volumes and 4D PET data. This software is written with options to allow the user to create output files using these DICOM SOP Classes:

| SOP Class Name                              | SOP Class UID                 |
|---------------------------------------------|-------------------------------|
| CT Image Storage                            | 1.2.840.10008.5.1.4.1.1.2     |
| Enhanced CT Image Storage                   | 1.2.840.10008.5.1.4.1.1.2.1   |
| Legacy Converted Enhanced CT Image Storage  | 1.2.840.10008.5.1.4.1.1.2.2   |
| Positron Emission Tomography Image Storage  | 1.2.840.10008.5.1.4.1.1.128   |
| Enhanced PET Image Storage                  | 1.2.840.10008.5.1.4.1.1.130   |
| Legacy Converted Enhanced PET Image Storage | 1.2.840.10008.5.1.4.1.1.128.1 |



# Installation
1. pixi-inveon is a Python package that relies on python 3.10 or greater and pydicom 2.4.0 or greater
2. While in the early stages of development, the package is installed at test.pypi.org.

```
pip install -v  pydicom
pip install -v -i https://test.pypi.org/simple/ inveonimaging
```

# Usage
## Convert a Folder of Inveon files
* Convert a folder of Inveon files into one DICOM Study with a single DICOM Study Instance UID
* Each Inveon .img/.hdr pair is converted to one DICOM Series
* The default action is to produce CT Image and PET Image DICOM Part 10 files with each series stored in a separate folder.
* Files are named using the Instance Numbers generated by the software.
  * The user can add separate prefixes for CT and PET data
* Program does not tolerate files with other extensions in the input folder. It will raise an exception.
* Program does not tolerate mismatched .img and .hdr files.
* In the pre-beta period, do not use the -l and/or -m options.


```
python3 -m inveonimaging.inveonFolder2DICOM --help
usage: inveonFolder2DICOM.py [-h] [-c CT_PREFIX] [-p PET_PREFIX] [-f FILE] [-l] [-m] InveonFolder OutputFolder

Inveon native .img/.hdr file to DICOM original

positional arguments:
  InveonFolder          Path to Inveon .hdr/.img file(s)
  OutputFolder          Path to output folder for DICOM files

options:
  -h, --help            show this help message and exit
  -c CT_PREFIX, --ct CT_PREFIX
                        Prefix for a CT file
  -p PET_PREFIX, --pet PET_PREFIX
                        Prefix for a PET file
  -f FILE, --file FILE  Name of output file for multiframe output
  -l, --legacyconverted
  -m, --multiframe

```

**Example With CT and PET Scans**
The folder */opt/datasets/SAI_WUSTL/Sample_Inveon_DICOM/test_1* contains these four files:
* mpet4800a_ct1_v1.ct.img
* mpet4800a_ct1_v1.ct.img.hdr
* mpet4800a_em111_v1.pet.img
* mpet4800a_em111_v1.pet.img.hdr

```
python3 -m inveonimaging.inveonFolder2DICOM -c CT- -p PET- /opt/datasets/SAI_WUSTL/Sample_Inveon_DICOM/test_1 /tmp/test_1/single_frame
```
This produces (where xxxxxx is the generated DICOM Intance Number)
* /tmp/test_1/single_frame/1/CT-xxxxxx.dcm
* /tmp/test_1/single_frame/2/PET-xxxxxx.dcm



# Notes
* There are known [issues](issues)
